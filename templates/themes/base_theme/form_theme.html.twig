{% use 'tailwind_2_layout.html.twig' %}

{%- block form_row -%}
    {%- set row_class = row_class|default('mb-3') -%}
    {{- parent() -}}
{%- endblock form_row -%}

{%- block widget_attributes -%}
    {% if type is defined and type == "file" %}
        {%- set widget_class = widget_class|default('file-input') -%}
    {% elseif type is defined and type == "password" %}
        {%- set widget_class = widget_class|default('input border-s-0 rounded-r-none') -%}
    {% else %}
        {%- set widget_class = widget_class|default('input') -%}
    {% endif %}
    {%- set widget_disabled_class = widget_disabled_class|default('cursor-not-allowed') -%}
    {%- set widget_errors_class = widget_errors_class|default('text-danger') -%}
    {{- parent() -}}
{%- endblock widget_attributes -%}

{%- block choice_widget_expanded -%}
    {%- set attr = attr|merge({ class: attr.class|default('mt-2') }) -%}
    <div {{ block('widget_container_attributes') }}>
        {%- for child in form %}
            <div class="flex items-center mt-2">
                {{- form_widget(child) -}}
                {{- form_label(child, null, { translation_domain: choice_translation_domain }) -}}
            </div>
        {% endfor -%}
    </div>
{%- endblock choice_widget_expanded -%}

{%- block form_label -%}
    {%- set label_class = label_class|default('form-label') -%}
    {{- parent() -}}
{%- endblock form_label -%}

{%- block form_help -%}
    {%- set help_class = help_class|default('form-info text-gray-800 text-2sm font-normal') -%}
    {{- parent() -}}
{%- endblock form_help -%}

{%- block form_errors -%}
    {%- set error_item_class = error_item_class|default('text-danger') -%}
    {{- parent() -}}
{%- endblock form_errors -%}

{%- block button_widget -%}
    {%- set attr = attr|merge({
        class: attr.class|default('btn btn-primary')
    }) -%}
    {{- parent() -}}
{%- endblock button_widget -%}

{%- block checkbox_widget -%}
    {%- set widget_class = widget_class|default('checkbox mr-2') -%}
    {{- parent() -}}
{%- endblock checkbox_widget -%}


{%- block radio_widget -%}
    {%- set widget_class = widget_class|default('radio mr-2') -%}
    {{- parent() -}}
{%- endblock radio_widget -%}

{%- block textarea_widget -%}
    {%- set widget_class = widget_class|default('textarea') -%}
    {{- parent() -}}
{%- endblock textarea_widget -%}

{% block async_file_row %}
    <div class='mb-3'>
        {{ form_label(form) }}
        {{ form_errors(form) }}
        {{ component('AsyncFileInput', {
            vars: form.vars
        }) }}
        {{ form_help(form) }}
    </div>
{% endblock %}

{% block live_collection_button_add_widget %}
    {% set attr = attr|merge({'class': attr.class|default('btn btn-success btn-sm mt-1')}) %}
    {% set translation_domain = false %}
    {% set label_html = true %}
    {%- set label -%}
        <i class='ki-filled ki-plus'></i>
        {{ label|default('Add')|trans({}, 'forms') }}
    {%- endset -%}
    {{ block('button_widget') }}
{% endblock live_collection_button_add_widget %}

{% block live_collection_button_delete_widget %}
    {% set attr = attr|merge({'class': attr.class|default('btn btn-danger btn-sm')}) %}
    {% set translation_domain = false %}
    {% set label_html = true %}
    {%- set label -%}
        <i class='ki-filled ki-trash'></i>
        {{ label|default('Delete')|trans({}, 'forms') }}
    {%- endset -%}
    {{ block('button_widget') }}
{% endblock live_collection_button_delete_widget %}

{% block live_table_collection_row %}
    {% set attr = attr|merge({'class': attr.class|default('')}) %}
     <div {{ block('widget_container_attributes') }} >
        <table class="table table-border caption-top">
            <caption class="text-start font-bold mb-3 sticky left-0 text-3xl p-3">
                {{ form_label(form) }}
            </caption>
            <thead class="text-xs uppercase">
                <tr class="border-b border-t">
                    {% for prototypeChild in prototype %}
                        <th class="min-w-10 text-gray-700 font-normal text-start text-nowrap">
                            <span>{{ form_label(prototypeChild) }}</span>
                        </th>
                    {% endfor %}
                <tr>
            </thead>
            <tbody>
                {% for index, child in form %}
                    <tr>
                    {% if not child.rendered %}
                        {% for innerChild in child %}
                            {% if not innerChild.rendered %}
                                <td class="px-2 py-2 align-baseline">
                                    {{ form_widget(innerChild) }}
                                    {{ form_errors(innerChild) }}
                                </td>
                            {% endif %}
                        {% endfor %}
                        {%- if child.vars.button_delete is defined and not child.vars.button_delete.rendered -%}
                            <td class="px-2 py-2 align-baseline">
                                {{ form_row(child.vars.button_delete) }}
                            </td>
                        {%- endif -%}
                    {% endif %}
                    </tr>
                {%- endfor -%}
            </tbody>
        </table>
        {%- if button_add is defined and not button_add.rendered -%}
            {{ form_row(button_add) }}
        {%- endif -%}
    </div>
{% endblock %}

{% block table_collection_row %}
    
    {% set attr = attr|merge({'data-name-prefix': full_name}) %}
    {% set attr = attr|merge({'class': attr.class|default('')}) %}
    {% set attr = attr|merge({'data-name-prefix': full_name}) %}

     <div {{ block('widget_container_attributes') }} data-controller='table-collection'>
        <table class="table table-border caption-top">
            <caption class="text-start font-extrabold mb-3 sticky left-0 text-3xl p-3">
                {{ form.vars.label }}
            </caption>
            <thead class="text-xs uppercase">
                <tr>
                    {% for prototypeChild in prototype %}
                        <th class="px-6 py-3 text-nowrap">
                            <span>{{ form_label(prototypeChild) }}</span>
                        </th>
                    {% endfor %}
                <tr>
            </thead>
            <tbody>
            {% for index, child in form %}
                    <tr>
                    {% if not child.rendered %}
                        {% for innerChild in child %}
                            {% if not innerChild.rendered %}
                                <td class="px-2 py-2 align-baseline">
                                    {{ form_widget(innerChild) }}
                                    {{ form_errors(innerChild) }}
                                </td>
                            {% endif %}
                        {% else %}
                             <td class="px-2 py-2 align-baseline">
                                {{ form_widget(child) }}
                                {{ form_errors(child) }}
                            </td>
                        {% endfor %}
                        {% if allow_delete %}
                            <td class="px-2 py-2 align-baseline">
                                <button type='button' class='btn btn-danger btn-sm delete-table-collection-item'>
                                    <i class='ki-filled ki-trash'></i>
                                </button>
                            </td>
                        {% endif %}
                    {% endif %}
                    </tr>
            {%- endfor -%}
            </tbody>
        </table>
        {% if allow_add %}
                {% if prototype is defined %}
                <template>
                    <tr class='hover:bg-gray-200 border-b dark:bg-gray-800 dark:border-gray-700 dark:hover:bg-gray-600'>
                        {% for prototypeChild in prototype %}
                            {% if not prototypeChild.rendered %}
                                <td class="px-2 py-2 align-baseline">
                                    {{ form_widget(prototypeChild) }}
                                    {{ form_errors(prototypeChild) }}
                                </td>
                            {% endif %}
                        {% else %}
                             <td class="px-2 py-2 align-baseline">
                                {{ form_widget(prototype) }}
                                {{ form_errors(prototype) }}
                            </td>
                        {% endfor %}
                        {% if allow_delete %}
                            <td class="px-2 py-2 align-baseline">
                                <button type='button' class='btn btn-danger btn-sm delete-table-collection-item'>
                                    <i class='ki-filled ki-trash'></i>
                                </button>
                            </td>
                        {% endif %}
                    </tr>
                </template>
                {% endif %}
            <button class="btn btn-sm btn-primary mt-2 add-new-table-collection-item" type='button'>
                <i class='ki-filled ki-plus'></i>
                <span>
                    {% if form.vars.label %}
                        {% trans with {label: form.vars.label} %}Add New label{% endtrans %}
                    {% else %}
                        {% trans %}Add{% endtrans %}
                    {% endif %}
                </span>
            </button>
        {% endif %}
    </div>
{% endblock %}
{%- block form_widget_simple -%}
    {%- set type = type|default('text') -%}
    {%- if type == 'password' -%}
        <div class="input ps-0 items-stretch" data-toggle-password="true">
            <input type="{{ type }}" {{ block('widget_attributes') }} {% if value is not empty %}value="{{ value }}" {% endif %}/>
            <div class="btn btn-icon" data-toggle-password-trigger="true">
                <i class="ki-outline ki-eye toggle-password-active:hidden"></i>
                <i class="ki-outline ki-eye-slash !hidden toggle-password-active:!block"></i>
            </div>
        </div>
    {% else %}
        {{ parent() }}
    {%- endif -%}
{%- endblock form_widget_simple -%}
